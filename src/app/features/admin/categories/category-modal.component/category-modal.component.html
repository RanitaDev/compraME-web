<!-- components/category-modal/category-modal.component.html -->
<!-- Overlay del Modal -->
<div *ngIf="isVisible"
     class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
     (click)="onOverlayClick($event)">

  <!-- Contenido del Modal -->
  <div class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-md transform transition-all duration-300"
       (click)="$event.stopPropagation()">

    <!-- Header del Modal -->
    <div class="modal-header flex items-center justify-between p-6 border-b border-slate-200">
      <div>
        <h2 class="text-xl font-bold text-slate-800">
          {{ isEditMode ? 'Editar Categoría' : 'Nueva Categoría' }}
        </h2>
        <p class="text-sm text-slate-600 mt-1">
          {{ isEditMode ? 'Modifica los datos de la categoría' : 'Completa la información de la nueva categoría' }}
        </p>
      </div>

      <!-- Botón Cerrar -->
      <button class="close-btn p-2 hover:bg-slate-100 rounded-lg transition-colors duration-200"
              (click)="onClose()"
              [attr.aria-label]="'Cerrar modal'">
        <i class="pi pi-times text-slate-600 text-lg"></i>
      </button>
    </div>

    <!-- Formulario -->
    <form (ngSubmit)="onSubmit()" #categoryForm="ngForm" class="modal-body p-6 space-y-4">

      <!-- Nombre de la Categoría -->
      <div class="form-group">
        <label for="nombre" class="block text-sm font-medium text-slate-700 mb-2">
          Nombre de la categoría *
        </label>
        <input type="text"
               id="nombre"
               name="nombre"
               [(ngModel)]="categoryData.nombre"
               #nombreInput="ngModel"
               required
               maxlength="50"
               placeholder="Ej: Electrónicos"
               class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
               [class.border-red-300]="nombreInput.invalid && nombreInput.touched">

        <!-- Error del nombre -->
        <div *ngIf="nombreInput.invalid && nombreInput.touched"
             class="error-message text-red-600 text-sm mt-1 flex items-center gap-1">
          <i class="pi pi-exclamation-triangle text-xs"></i>
          <span *ngIf="nombreInput.errors?.['required']">El nombre is requerido</span>
          <span *ngIf="nombreInput.errors?.['maxlength']">Máximo 50 caracteres</span>
        </div>
      </div>

      <!-- Descripción -->
      <div class="form-group">
        <label for="descripcion" class="block text-sm font-medium text-slate-700 mb-2">
          Descripción *
        </label>
        <textarea id="descripcion"
                  name="descripcion"
                  [(ngModel)]="categoryData.descripcion"
                  #descripcionInput="ngModel"
                  required
                  maxlength="200"
                  rows="3"
                  placeholder="Describe brevemente esta categoría..."
                  class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 resize-none"
                  [class.border-red-300]="descripcionInput.invalid && descripcionInput.touched"></textarea>

        <!-- Contador de caracteres y errores -->
        <div class="flex justify-between items-center mt-1">
          <div *ngIf="descripcionInput.invalid && descripcionInput.touched"
               class="error-message text-red-600 text-sm flex items-center gap-1">
            <i class="pi pi-exclamation-triangle text-xs"></i>
            <span *ngIf="descripcionInput.errors?.['required']">La descripción es requerida</span>
            <span *ngIf="descripcionInput.errors?.['maxlength']">Máximo 200 caracteres</span>
          </div>
          <span class="text-xs text-slate-500">
            {{ categoryData.descripcion.length }}/200
          </span>
        </div>
      </div>

      <!-- URL de la Imagen -->
      <div class="form-group">
        <label for="imagen" class="block text-sm font-medium text-slate-700 mb-2">
          URL de la imagen *
        </label>
        <div class="space-y-2">
          <input type="url"
                 id="imagen"
                 name="imagen"
                 [(ngModel)]="categoryData.imagen"
                 #imagenInput="ngModel"
                 required
                 placeholder="https://ejemplo.com/imagen.jpg"
                 class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                 [class.border-red-300]="imagenInput.invalid && imagenInput.touched">

          <!-- Preview de la imagen -->
          <div *ngIf="categoryData.imagen" class="image-preview">
            <img [src]="categoryData.imagen"
                 [alt]="categoryData.nombre || 'Preview'"
                 class="w-full h-24 object-cover rounded-lg border border-slate-200"
                 (error)="onImageError($event)"
                 loading="lazy">
          </div>
        </div>

        <!-- Error de imagen -->
        <div *ngIf="imagenInput.invalid && imagenInput.touched"
             class="error-message text-red-600 text-sm mt-1 flex items-center gap-1">
          <i class="pi pi-exclamation-triangle text-xs"></i>
          <span *ngIf="imagenInput.errors?.['required']">La imagen es requerida</span>
          <span *ngIf="imagenInput.errors?.['url']">Debe ser una URL válida</span>
        </div>
      </div>

      <!-- Estado Activo -->
      <div class="form-group">
        <label class="flex items-center gap-3 cursor-pointer">
          <input type="checkbox"
                 name="activa"
                 [(ngModel)]="categoryData.activa"
                 class="w-4 h-4 text-blue-600 border-slate-300 rounded focus:ring-blue-500 focus:ring-2">
          <div>
            <span class="text-sm font-medium text-slate-700">Categoría activa</span>
            <p class="text-xs text-slate-500">Las categorías activas son visibles para los usuarios</p>
          </div>
        </label>
      </div>

      <!-- Botones de Acción -->
      <div class="modal-footer flex gap-3 pt-4 border-t border-slate-200">
        <!-- Botón Cancelar -->
        <button type="button"
                class="cancel-btn flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors duration-200 font-medium"
                (click)="onClose()">
          Cancelar
        </button>

        <!-- Botón Guardar -->
        <button type="submit"
                class="save-btn flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors duration-200 font-medium flex items-center justify-center gap-2"
                [disabled]="categoryForm.invalid || isLoading">

          <!-- Loading spinner -->
          <i *ngIf="isLoading" class="pi pi-spin pi-spinner text-sm"></i>

          <!-- Íconos y texto -->
          <ng-container *ngIf="!isLoading">
            <i class="pi pi-check text-sm"></i>
            <span>{{ isEditMode ? 'Actualizar' : 'Crear' }}</span>
          </ng-container>

          <!-- Texto loading -->
          <span *ngIf="isLoading">
            {{ isEditMode ? 'Actualizando...' : 'Creando...' }}
          </span>
        </button>
      </div>
    </form>
  </div>
</div>
