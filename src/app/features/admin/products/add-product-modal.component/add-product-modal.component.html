<!-- Contenido del modal para PrimeNG Dialog -->
<div class="bg-white text-gray-900">
<form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="p-4 bg-white">
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

    <!-- Información básica -->
    <div class="space-y-4">
      <h3 class="text-base font-medium text-gray-900 border-b border-gray-200 pb-2">
        Información Básica
      </h3>

      <!-- Nombre -->
      <div>
        <label for="nombre" class="block text-sm font-medium text-gray-700 mb-1">
          Nombre del producto *
        </label>
        <input
          type="text"
          id="nombre"
          formControlName="nombre"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
          placeholder="Ej: iPhone 15 Pro Max"
        >
        <div *ngIf="productForm.get('nombre')?.invalid && productForm.get('nombre')?.touched"
             class="text-red-600 text-xs mt-1">
          El nombre es requerido (mínimo 3 caracteres)
        </div>
      </div>

      <!-- Descripción -->
      <div>
        <label for="descripcion" class="block text-sm font-medium text-gray-700 mb-1">
          Descripción *
        </label>
        <textarea
          id="descripcion"
          formControlName="descripcion"
          rows="3"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-sm"
          placeholder="Describe las características principales del producto..."
        ></textarea>
        <div *ngIf="productForm.get('descripcion')?.invalid && productForm.get('descripcion')?.touched"
             class="text-red-600 text-xs mt-1">
          La descripción es requerida (mínimo 10 caracteres)
        </div>
      </div>

      <!-- Precio y Stock -->
      <div class="grid grid-cols-2 gap-3">
        <div>
          <label for="precio" class="block text-sm font-medium text-gray-700 mb-1">
            Precio (MXN) *
          </label>
          <input
            type="number"
            id="precio"
            formControlName="precio"
            step="0.01"
            min="0"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
            placeholder="0.00"
          >
          <div *ngIf="productForm.get('precio')?.invalid && productForm.get('precio')?.touched"
               class="text-red-600 text-xs mt-1">
            Precio requerido > 0
          </div>
        </div>

        <div>
          <label for="stock" class="block text-sm font-medium text-gray-700 mb-1">
            Stock disponible *
          </label>
          <input
            type="number"
            id="stock"
            formControlName="stock"
            min="0"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
            placeholder="0"
          >
          <div *ngIf="productForm.get('stock')?.invalid && productForm.get('stock')?.touched"
               class="text-red-600 text-xs mt-1">
            Stock requerido ≥ 0
          </div>
        </div>
      </div>

      <!-- Categoría -->
      <div>
        <label for="idCategoria" class="block text-sm font-medium text-gray-700 mb-1">
          Categoría *
        </label>
        <select
          id="idCategoria"
          formControlName="idCategoria"
          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
        >
          <option value="">Seleccionar categoría</option>
          <option value="1">Electrónicos</option>
          <option value="2">Deportes</option>
          <option value="3">Fotografía</option>
          <option value="4">Computadoras</option>
          <option value="5">Tablets</option>
        </select>
        <div *ngIf="productForm.get('idCategoria')?.invalid && productForm.get('idCategoria')?.touched"
             class="text-red-600 text-xs mt-1">
          Selecciona una categoría
        </div>
      </div>
    </div>

    <!-- Configuración e imágenes -->
    <div class="space-y-4">
      <h3 class="text-base font-medium text-gray-900 border-b border-gray-200 pb-2">
        Configuración
      </h3>

      <!-- Imágenes -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">
          Imágenes del producto
        </label>

        <!-- Lista de imágenes actuales -->
        <div class="space-y-2 mb-3" *ngIf="imageUrls.length > 0">
          <div
            *ngFor="let imagen of imageUrls; let i = index"
            class="flex items-center gap-2 p-2 border border-gray-200 rounded"
          >
            <img
              [src]="imagen || '/assets/placeholderImage.webp'"
              alt="Imagen del producto"
              class="w-8 h-8 object-cover rounded border flex-shrink-0"
              onerror="this.src='/assets/placeholder.jpg'"
            >
            <input
              type="url"
              [(ngModel)]="imageUrls[i]"
              [ngModelOptions]="{standalone: true}"
              class="flex-1 px-2 py-1 border border-gray-300 rounded text-xs focus:ring-1 focus:ring-blue-500 focus:border-transparent"
              placeholder="https://ejemplo.com/imagen.jpg"
              (blur)="updateFormImages()"
            >
            <button
              type="button"
              class="text-red-500 hover:text-red-700 p-1 flex-shrink-0"
              (click)="removeImage(i)"
              *ngIf="imageUrls.length > 1"
            >
              <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- Agregar nueva imagen -->
        <button
          type="button"
          class="w-full py-2 px-3 border-2 border-dashed border-gray-300 rounded text-gray-600 hover:border-gray-400 hover:text-gray-700 transition-colors text-sm"
          (click)="addImageUrl()"
        >
          + Agregar imagen
        </button>

        <p class="text-xs text-gray-500 mt-1">
          La primera imagen será la principal
        </p>
      </div>

      <!-- Color principal -->
      <div>
        <label for="color" class="block text-sm font-medium text-gray-700 mb-1">
          Color principal *
        </label>
        <div class="flex items-center gap-2">
          <input
            type="color"
            id="color"
            formControlName="color"
            class="w-10 h-8 border border-gray-300 rounded cursor-pointer flex-shrink-0"
          >
          <input
            type="text"
            formControlName="color"
            class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
            placeholder="#000000"
          >
        </div>
        <div *ngIf="productForm.get('color')?.invalid && productForm.get('color')?.touched"
             class="text-red-600 text-xs mt-1">
          Selecciona un color
        </div>
      </div>

      <!-- Checkboxes de configuración -->
      <div class="space-y-3">
        <div class="flex items-center">
          <input
            type="checkbox"
            id="activo"
            formControlName="activo"
            class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
          >
          <label for="activo" class="ml-2 text-sm text-gray-700">
            Producto activo
          </label>
        </div>

        <div class="flex items-center">
          <input
            type="checkbox"
            id="destacado"
            formControlName="destacado"
            class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
          >
          <label for="destacado" class="ml-2 text-sm text-gray-700">
            Producto destacado
          </label>
        </div>
      </div>

      <!-- Vista previa del color -->
      <div class="mt-3">
        <label class="block text-sm font-medium text-gray-700 mb-2">
          Vista previa
        </label>
        <div
          class="w-full h-8 rounded border border-gray-300"
          [style.background]="productForm.get('color')?.value || '#ffffff'"
        ></div>
      </div>
    </div>
  </div>

  <!-- Footer con botones -->
  <div class="flex items-center justify-between pt-6 mt-6 border-t border-gray-200">
    <p class="text-xs text-gray-600">
      * Campos obligatorios
    </p>
    <div class="flex items-center gap-3">
      <button
        type="button"
        class="px-4 py-2 text-gray-700 border border-gray-300 rounded hover:bg-gray-50 transition-colors text-sm"
        (click)="closeModal()"
      >
        Cancelar
      </button>
      <button
        type="submit"
        [disabled]="productForm.invalid || isSubmitting"
        class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm"
      >
        <span *ngIf="isSubmitting" class="flex items-center gap-2">
          <svg class="w-4 h-4 animate-spin" viewBox="0 0 24 24" fill="none">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          {{ isEditMode ? 'Actualizando...' : 'Guardando...' }}
        </span>
        <span *ngIf="!isSubmitting">
          {{ isEditMode ? 'Actualizar' : 'Guardar' }} Producto
        </span>
      </button>
    </div>
  </div>
</form>
</div>
