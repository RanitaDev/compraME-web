<!-- Encabezado con botón para agregar -->
<div class="flex items-center justify-between mb-6">
  <div>
    <h3 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
      <i class="pi pi-map text-blue-600"></i>
      Mis Direcciones
    </h3>
    <p class="text-sm text-gray-600 mt-1">Administra tus direcciones de envío y facturación</p>
  </div>
  <button
    *ngIf="!mostrarFormulario"
    (click)="nuevaDireccionClick()"
    class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg transition-colors duration-200 flex items-center gap-2"
    type="button"
  >
    <i class="pi pi-plus text-sm"></i>
    <span class="hidden sm:inline">Nueva dirección</span>
  </button>
</div>

<!-- Formulario para nueva/editar dirección -->
<div *ngIf="mostrarFormulario" class="bg-white border border-gray-200 rounded-xl p-6 mb-6">
  <div class="flex items-center justify-between mb-4">
    <h4 class="text-lg font-semibold text-gray-900">
      {{ editandoDireccion ? 'Editar Dirección' : 'Nueva Dirección' }}
    </h4>
    <button
      (click)="cancelarFormulario()"
      class="text-gray-400 hover:text-gray-600 transition-colors duration-200"
      type="button"
    >
      <i class="pi pi-times text-lg"></i>
    </button>
  </div>

  <form (ngSubmit)="guardarDireccion()" class="space-y-4">
    <!-- Tipo y nombre -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de dirección</label>
        <select
          [(ngModel)]="nuevaDireccion.tipo"
          name="tipo"
          required
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
          <option value="casa">🏠 Casa</option>
          <option value="oficina">🏢 Oficina</option>
          <option value="otro">📍 Otro</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Nombre/Alias</label>
        <input
          type="text"
          [(ngModel)]="nuevaDireccion.nombre"
          name="nombre"
          required
          placeholder="Ej: Casa de mamá, Oficina principal..."
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
      </div>
    </div>

    <!-- Calle y número -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="md:col-span-2">
        <label class="block text-sm font-medium text-gray-700 mb-2">Calle</label>
        <input
          type="text"
          [(ngModel)]="nuevaDireccion.calle"
          name="calle"
          required
          placeholder="Nombre de la calle"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Número</label>
        <input
          type="text"
          [(ngModel)]="nuevaDireccion.numero"
          name="numero"
          required
          placeholder="123"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
      </div>
    </div>

    <!-- Colonia, ciudad, estado -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Colonia</label>
        <input
          type="text"
          [(ngModel)]="nuevaDireccion.colonia"
          name="colonia"
          required
          placeholder="Colonia o delegación"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Ciudad</label>
        <input
          type="text"
          [(ngModel)]="nuevaDireccion.ciudad"
          name="ciudad"
          required
          placeholder="Ciudad"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Estado</label>
        <input
          type="text"
          [(ngModel)]="nuevaDireccion.estado"
          name="estado"
          required
          placeholder="Estado"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
      </div>
    </div>

    <!-- Código postal y teléfono -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Código postal</label>
        <input
          type="text"
          [(ngModel)]="nuevaDireccion.codigoPostal"
          name="codigoPostal"
          required
          placeholder="12345"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Teléfono (opcional)</label>
        <input
          type="tel"
          [(ngModel)]="nuevaDireccion.telefono"
          name="telefono"
          placeholder="55-1234-5678"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
      </div>
    </div>

    <!-- Checkboxes -->
    <div class="space-y-3">
      <label class="flex items-center">
        <input
          type="checkbox"
          [(ngModel)]="nuevaDireccion.esPrincipal"
          name="esPrincipal"
          class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
        >
        <span class="ml-3 text-sm text-gray-700">Establecer como dirección principal</span>
      </label>
      <label class="flex items-center">
        <input
          type="checkbox"
          [(ngModel)]="nuevaDireccion.esFacturacion"
          name="esFacturacion"
          class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
        >
        <span class="ml-3 text-sm text-gray-700">Usar para facturación</span>
      </label>
    </div>

    <!-- Botones -->
    <div class="flex gap-3 pt-4">
      <button
        type="submit"
        class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-6 py-2 rounded-lg transition-colors duration-200"
      >
        {{ editandoDireccion ? 'Actualizar' : 'Guardar' }}
      </button>
      <button
        type="button"
        (click)="cancelarFormulario()"
        class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium px-6 py-2 rounded-lg transition-colors duration-200"
      >
        Cancelar
      </button>
    </div>
  </form>
</div>

<!-- Lista de direcciones -->
<div class="space-y-4">
  <div
    *ngFor="let direccion of direcciones; trackBy: trackByDireccion"
    class="bg-white border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200"
    [class.ring-2]="direccion.esPrincipal"
    [class.ring-blue-500]="direccion.esPrincipal"
    [class.bg-blue-50]="direccion.esPrincipal"
  >
    <!-- Header de la dirección -->
    <div class="flex items-start justify-between mb-4">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
          <i [class]="'pi ' + getTipoIcono(direccion.tipo)" class="text-blue-600 text-lg"></i>
        </div>
        <div>
          <h4 class="font-semibold text-gray-900 flex items-center gap-2">
            {{ direccion.nombre }}
            <span *ngIf="direccion.esPrincipal" class="bg-blue-500 text-white text-xs px-2 py-1 rounded-full font-medium">
              Principal
            </span>
            <span *ngIf="direccion.esFacturacion" class="bg-green-500 text-white text-xs px-2 py-1 rounded-full font-medium">
              Facturación
            </span>
          </h4>
          <p class="text-sm text-gray-600">{{ getTipoTexto(direccion.tipo) }}</p>
        </div>
      </div>

      <!-- Menú de acciones -->
      <div class="flex items-center gap-2">
        <button
          *ngIf="!direccion.esPrincipal"
          (click)="establecerComoPrincipal(direccion)"
          class="text-sm text-blue-600 hover:text-blue-700 font-medium transition-colors duration-200"
          type="button"
        >
          Hacer principal
        </button>
        <button
          (click)="editarDireccion(direccion)"
          class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-all duration-200"
          type="button"
        >
          <i class="pi pi-pencil"></i>
        </button>
        <button
          (click)="eliminarDireccion(direccion)"
          class="p-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200"
          type="button"
        >
          <i class="pi pi-trash"></i>
        </button>
      </div>
    </div>

    <!-- Detalles de la dirección -->
    <div class="text-gray-700 space-y-1">
      <p class="font-medium">{{ direccion.calle }} {{ direccion.numero }}</p>
      <p>{{ direccion.colonia }}, {{ direccion.ciudad }}</p>
      <p>{{ direccion.estado }}, CP: {{ direccion.codigoPostal }}</p>
      <p *ngIf="direccion.telefono" class="text-sm text-gray-600">
        <i class="pi pi-phone mr-2"></i>{{ direccion.telefono }}
      </p>
    </div>
  </div>
</div>

<!-- Estado vacío -->
<div *ngIf="!direcciones || direcciones.length === 0" class="text-center py-12">
  <div class="w-20 h-20 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center">
    <i class="pi pi-map-marker text-2xl text-gray-400"></i>
  </div>
  <h3 class="text-lg font-semibold text-gray-700 mb-2">No tienes direcciones guardadas</h3>
  <p class="text-gray-500 mb-6">Agrega una dirección para facilitar tus compras</p>
  <button
    (click)="nuevaDireccionClick()"
    class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-6 py-3 rounded-lg transition-colors duration-200"
    type="button"
  >
    <i class="pi pi-plus mr-2"></i>
    Agregar primera dirección
  </button>
</div>
